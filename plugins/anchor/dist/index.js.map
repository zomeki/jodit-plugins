{"version":3,"file":"index.js","sources":["../src/jodit.js","../src/plugin.js","../src/lang.js","../src/index.js"],"sourcesContent":["import * as module from 'jodit';\n\nexport default module.Jodit || module;\n","import Jodit from './jodit.js';\nimport icon from './images/icon.svg';\n\nexport default class AnchorPlugin {\n  init(jodit) {\n    this.jodit = jodit;\n\n    jodit.options.controls.anchor = {\n      name: 'anchor',\n      icon: icon,\n      tooltip: jodit.i18n('anchorSetAnchor'),\n      popup: this.popup.bind(this),\n      isActive: this.isActive.bind(this)\n    };\n\n    this.afterEnterFunc = this.afterEnter.bind(this);\n    jodit.events.on('afterEnter', this.afterEnterFunc);\n  }\n\n  destruct() {\n    this.jodit.events.off('afterEnter', this.afterEnterFunc);\n  }\n\n  popup(jodit, current, close) {\n    const { UIForm, UIInput, Button } = Jodit.modules;\n\n    const form = new UIForm(this.jodit);\n\n    const input = new UIInput(this.jodit, {\n      name: 'id',\n      label: 'anchorAnchorID'\n    });\n\n    const button = new Button(this.jodit, 'ok', 'anchorSet', 'primary');\n\n    form.append(input);\n    form.append(button);\n\n    const target = this.currentElement();\n\n    if (target && target.id) {\n      input.value = target.id;\n    }\n\n    jodit.selection.save();\n\n    button.onAction(() => {\n      if (target) {\n        const id = input.value.trim();\n        if (id) {\n          target.setAttribute('id', id);\n        } else {\n          target.removeAttribute('id');\n        }\n        jodit.synchronizeValues();\n      }\n      close();\n    });\n\n    input.container.addEventListener('keydown', event => {\n      if (event.key === 'Enter') {\n        button.button.click();\n        event.preventDefault();\n      }\n    });\n\n    return form;\n  }\n\n  isActive(jodit) {\n    const elem = this.currentElement();\n    return elem && elem.hasAttribute('id');\n  }\n\n  afterEnter(event) {\n    let current = this.jodit.selection.current()\n    if (!current) return;\n    if (current.nodeType !== 1) current = current.parentElement;\n\n    const previous = current.previousElementSibling;\n    if (!previous) return;\n\n    if (current.hasAttribute('id') && previous.hasAttribute('id') && current.id === previous.id) {\n      if (previous.childNodes.length === 1 && previous.childNodes[0].tagName == 'BR') {\n        previous.removeAttribute('id');\n      } else {\n        current.removeAttribute('id');\n      }\n    }\n  }\n\n  currentElement() {\n    const current = this.findCurrentElement();\n    if (current === this.jodit.editor) return null;\n    return current;\n  }\n\n  findCurrentElement() {\n    const node = this.jodit.selection.current();\n    if (!node) return null;\n\n    if (node.nodeType === Node.TEXT_NODE) {\n      if (node.textContent === '\\uFEFF' && node.previousElementSibling?.matches('jodit-media')) {\n        return node.previousElementSibling.querySelector('video, audio');\n      } else {\n        return node.parentElement;\n      }\n    } else if (node.matches('jodit')) {\n      return node.querySelector('iframe');\n    } else if (node.matches('jodit-media')) {\n      return node.querySelector('video, audio');\n    } else if (node.matches('span[id^=\"jodit-selection_marker\"]')) {\n      return node.parentNode;\n    }\n    return node;\n  }\n}\n","export default {\n  en: {\n    anchorSetAnchor: 'Set anchor ID',\n    anchorAnchorID: 'Anchor ID',\n    anchorSet: 'Set'\n  },\n  ja: {\n    anchorSetAnchor: 'アンカーIDを設定',\n    anchorAnchorID: 'アンカーID',\n    anchorSet: '設定'\n  }\n};\n","import Jodit from './jodit.js';\nimport Plugin from './plugin.js';\nimport lang from './lang.js';\nimport './index.scss';\n\nObject.keys(lang).forEach(locale => {\n  Jodit.lang[locale] = {\n    ...Jodit.lang[locale],\n    ...lang[locale]\n  }\n});\n\nJodit.plugins.add('anchor', Plugin);\n\nexport default Plugin;\n"],"names":["Jodit","module","AnchorPlugin","init","jodit","this","options","controls","anchor","name","icon","tooltip","i18n","popup","bind","isActive","afterEnterFunc","afterEnter","events","on","destruct","off","current","close","UIForm","UIInput","Button","modules","form","input","label","button","append","target","currentElement","id","value","selection","save","onAction","trim","setAttribute","removeAttribute","synchronizeValues","container","addEventListener","event","key","click","preventDefault","elem","hasAttribute","nodeType","parentElement","previous","previousElementSibling","childNodes","length","tagName","findCurrentElement","editor","node","Node","TEXT_NODE","textContent","matches","querySelector","parentNode","lang","en","anchorSetAnchor","anchorAnchorID","anchorSet","ja","Object","keys","forEach","locale","plugins","add","Plugin"],"mappings":"oUAEAA,EAAeC,EAAOD,OAASC,ECChB,MAAMC,EACnBC,IAAAA,CAAKC,GACHC,KAAKD,MAAQA,EAEbA,EAAME,QAAQC,SAASC,OAAS,CAC9BC,KAAM,SACNC,moBACAC,QAASP,EAAMQ,KAAK,mBACpBC,MAAOR,KAAKQ,MAAMC,KAAKT,MACvBU,SAAUV,KAAKU,SAASD,KAAKT,OAG/BA,KAAKW,eAAiBX,KAAKY,WAAWH,KAAKT,MAC3CD,EAAMc,OAAOC,GAAG,aAAcd,KAAKW,eACrC,CAEAI,QAAAA,GACEf,KAAKD,MAAMc,OAAOG,IAAI,aAAchB,KAAKW,eAC3C,CAEAH,KAAAA,CAAMT,EAAOkB,EAASC,GACpB,MAAMC,OAAEA,EAAMC,QAAEA,EAAOC,OAAEA,GAAW1B,EAAM2B,QAEpCC,EAAO,IAAIJ,EAAOnB,KAAKD,OAEvByB,EAAQ,IAAIJ,EAAQpB,KAAKD,MAAO,CACpCK,KAAM,KACNqB,MAAO,mBAGHC,EAAS,IAAIL,EAAOrB,KAAKD,MAAO,KAAM,YAAa,WAEzDwB,EAAKI,OAAOH,GACZD,EAAKI,OAAOD,GAEZ,MAAME,EAAS5B,KAAK6B,iBA4BpB,OA1BID,GAAUA,EAAOE,KACnBN,EAAMO,MAAQH,EAAOE,IAGvB/B,EAAMiC,UAAUC,OAEhBP,EAAOQ,SAAS,KACd,GAAIN,EAAQ,CACV,MAAME,EAAKN,EAAMO,MAAMI,OACnBL,EACFF,EAAOQ,aAAa,KAAMN,GAE1BF,EAAOS,gBAAgB,MAEzBtC,EAAMuC,mBACR,CACApB,MAGFM,EAAMe,UAAUC,iBAAiB,UAAWC,IACxB,UAAdA,EAAMC,MACRhB,EAAOA,OAAOiB,QACdF,EAAMG,oBAIHrB,CACT,CAEAb,QAAAA,CAASX,GACP,MAAM8C,EAAO7C,KAAK6B,iBAClB,OAAOgB,GAAQA,EAAKC,aAAa,KACnC,CAEAlC,UAAAA,CAAW6B,GACT,IAAIxB,EAAUjB,KAAKD,MAAMiC,UAAUf,UACnC,IAAKA,EAAS,OACW,IAArBA,EAAQ8B,WAAgB9B,EAAUA,EAAQ+B,eAE9C,MAAMC,EAAWhC,EAAQiC,uBACpBD,GAEDhC,EAAQ6B,aAAa,OAASG,EAASH,aAAa,OAAS7B,EAAQa,KAAOmB,EAASnB,KACpD,IAA/BmB,EAASE,WAAWC,QAAkD,MAAlCH,EAASE,WAAW,GAAGE,QAC7DJ,EAASZ,gBAAgB,MAEzBpB,EAAQoB,gBAAgB,MAG9B,CAEAR,cAAAA,GACE,MAAMZ,EAAUjB,KAAKsD,qBACrB,OAAIrC,IAAYjB,KAAKD,MAAMwD,OAAe,KACnCtC,CACT,CAEAqC,kBAAAA,GACE,MAAME,EAAOxD,KAAKD,MAAMiC,UAAUf,UAClC,OAAKuC,EAEDA,EAAKT,WAAaU,KAAKC,UACA,WAArBF,EAAKG,aAA4BH,EAAKN,wBAAwBU,QAAQ,eACjEJ,EAAKN,uBAAuBW,cAAc,gBAE1CL,EAAKR,cAELQ,EAAKI,QAAQ,SACfJ,EAAKK,cAAc,UACjBL,EAAKI,QAAQ,eACfJ,EAAKK,cAAc,gBACjBL,EAAKI,QAAQ,sCACfJ,EAAKM,WAEPN,EAfW,IAgBpB,ECnHF,IAAeO,EAAA,CACbC,GAAI,CACFC,gBAAiB,gBACjBC,eAAgB,YAChBC,UAAW,OAEbC,GAAI,CACFH,gBAAiB,YACjBC,eAAgB,SAChBC,UAAW,OCJfE,OAAOC,KAAKP,GAAMQ,QAAQC,IACxB7E,EAAMoE,KAAKS,GAAU,IAChB7E,EAAMoE,KAAKS,MACXT,EAAKS,MAIZ7E,EAAM8E,QAAQC,IAAI,SAAUC"}